<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Learning Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; background: #111827; }
        .aurora-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .aurora-background::before, .aurora-background::after {
            content: ''; position: absolute; filter: blur(80px); mix-blend-mode: screen; animation: aurora-flow 15s infinite linear; border-radius: 50%;
        }
        .aurora-background::before { background: radial-gradient(circle, rgba(99,102,241,0.4), transparent 60%); width:600px; height:600px; top:-150px; left:-200px; }
        .aurora-background::after { background: radial-gradient(circle, rgba(59,130,246,0.4), transparent 60%); width:500px; height:500px; bottom:-200px; right:-150px; animation-delay:-7.5s; }
        @keyframes aurora-flow { 0%,100%{transform:translateX(20px) translateY(-20px) scale(1);} 50%{transform:translateX(-20px) translateY(20px) scale(1.1);} }
        .glass-panel { background: rgba(255,255,255,0.1); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); border:1px solid rgba(255,255,255,0.2); }
        .inner-glass-panel { background: rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1); }
        .mode-btn-glass { transition: all .3s; color: rgba(255,255,255,0.7); position: relative; }
        .mode-btn-glass.active { color: white; }
        .mode-btn-glass.active::after { content:''; position:absolute; bottom:-8px; left:50%; transform:translateX(-50%); width:24px; height:3px; background:white; border-radius:2px; }
        .progress-bar { background: linear-gradient(90deg,#60a5fa,#3b82f6); transition: width .5s ease-in-out; }
        .math-block { display: inline-block; width: 20px; height:20px; margin:2px; }
        .block-container { display:flex; flex-wrap:wrap; justify-center; }
    </style>
</head>
<body class="text-gray-200 flex items-center justify-center min-h-screen p-4">
    <div class="aurora-background"></div>
    <div class="w-full max-w-4xl mx-auto">
        <div class="glass-panel shadow-2xl rounded-3xl overflow-hidden">
            <header class="p-6">
                <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                    <div class="text-center sm:text-left">
                        <h1 class="text-4xl font-bold text-white">AI Learning Assistant</h1>
                        <p id="header-subtitle" class="mt-2 text-sm text-blue-200">Say a math problem with an answer...</p>
                    </div>
                    <div id="gamification-display" class="w-full sm:w-1/3 text-right">
                        <div class="flex items-center justify-end space-x-3">
                            <span id="level-display" class="font-bold text-lg bg-white/20 text-white px-3 py-1 rounded-full">Level 1</span>
                            <span id="xp-display" class="font-semibold text-sm">0 / 100 XP</span>
                        </div>
                        <div class="w-full bg-white/10 rounded-full h-2.5 mt-2">
                            <div id="xp-progress-bar" class="progress-bar h-2.5 rounded-full" style="width:0%"></div>
                        </div>
                    </div>
                </div>
            </header>
            <main class="p-6">
                <div class="flex justify-center mb-8 space-x-4 border-b border-white/10 pb-4">
                    <button id="literacy-mode-btn" class="mode-btn-glass font-semibold py-2 px-6 text-base">Literacy</button>
                    <button id="math-mode-btn" class="mode-btn-glass active font-semibold py-2 px-6 text-base">Math</button>
                </div>
                <div class="flex flex-col items-center mb-8">
                    <button id="recordBtn" class="w-24 h-24 bg-white/20 text-white font-bold rounded-full shadow-lg border border-white/20 hover:bg-white/30 focus:outline-none transition transform hover:scale-105">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mx-auto" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8h-1a6 6 0 11-12 0H3a7.001 7.001 0 006 6.93V17H7v1h6v-1h-2v-2.07z" clip-rule="evenodd" /></svg>
                    </button>
                    <div id="status" class="mt-4 text-gray-400">Status: Idle</div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="inner-glass-panel p-6 rounded-2xl">
                        <h2 class="text-xl font-semibold text-white mb-4">Your Spoken Text</h2>
                        <div id="transcription" class="min-h-[200px] p-4 bg-black/10 rounded-lg text-gray-200">Your transcribed text will appear here...</div>
                    </div>
                    <div class="inner-glass-panel p-6 rounded-2xl">
                        <h2 class="text-xl font-semibold text-white mb-4">AI Analysis & Feedback</h2>
                        <div id="analysis" class="min-h-[200px] p-4 bg-black/10 rounded-lg text-gray-200">Potential errors and suggestions will appear here.</div>
                    </div>
                </div>
                <div id="guidance-section" class="mt-8 pt-6 border-t border-white/10 text-center text-gray-400">Try saying "two plus three equals five".</div>
            </main>
        </div>
    </div>

    <script>
        // State
        let currentMode = 'math', isRecording = false, finalTranscript = '', userLevel = 1, userXP = 0;
        const xpForLevelUp = 100;
        // UI refs
        const recordBtn = document.getElementById('recordBtn');
        const statusDiv = document.getElementById('status');
        const transcriptionDiv = document.getElementById('transcription');
        const analysisDiv = document.getElementById('analysis');
        const literacyBtn = document.getElementById('literacy-mode-btn');
        const mathBtn = document.getElementById('math-mode-btn');
        const headerSubtitle = document.getElementById('header-subtitle');
        const guidanceSection = document.getElementById('guidance-section');
        const levelDisplay = document.getElementById('level-display');
        const xpDisplay = document.getElementById('xp-display');
        const xpBar = document.getElementById('xp-progress-bar');

        // Speech
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const synthesis = window.speechSynthesis;
        let recognition;

        const wordMap = { 'zero':0,'one':1,'two':2,'three':3,'four':4,'five':5,'six':6,'seven':7,'eight':8,'nine':9,'plus':'+','minus':'-','times':'*','x':'*','divided by':'/','equals':'=' };

        function initialize() {
            if (!SpeechRecognition) return statusDiv.textContent='Your browser does not support Speech Recognition.';
            recognition = new SpeechRecognition(); recognition.continuous=true; recognition.interimResults=true; recognition.lang='en-US';
            recognition.onstart = () => { isRecording=true; statusDiv.textContent='Status: Listening...'; transcriptionDiv.textContent=''; analysisDiv.textContent='Waiting for you to finish...'; };
            recognition.onend = () => { isRecording=false; statusDiv.textContent='Status: Idle'; if(finalTranscript) processText(finalTranscript); };
            recognition.onerror = e => statusDiv.textContent=`Error: ${e.error}`;
            recognition.onresult = e => {
                let interim=''; for(let i=e.resultIndex;i<e.results.length;i++){ if(e.results[i].isFinal) finalTranscript+=e.results[i][0].transcript; else interim+=e.results[i][0].transcript; }
                transcriptionDiv.innerHTML = finalTranscript + `<span class="text-gray-500">${interim}</span>`;
            };
            recordBtn.onclick = () => isRecording? recognition.stop(): (finalTranscript='', recognition.start());
            literacyBtn.onclick = () => setMode('literacy'); mathBtn.onclick = () => setMode('math');
            setMode('math');
        }

        function setMode(mode) {
            currentMode=mode;
            literacyBtn.classList.toggle('active', mode==='literacy');
            mathBtn.classList.toggle('active', mode==='math');
            if(mode==='math'){
                headerSubtitle.textContent="Say a math problem like 'two plus three equals five'.";
                guidanceSection.textContent="Try saying 'two plus three equals five'.";
            } else {
                headerSubtitle.textContent="Say a sentence and I'll check for common errors.";
                guidanceSection.textContent="Try saying 'Their car is over there.'";
            }
        }

        function processText(text) {
            transcriptionDiv.textContent = text;
            if(currentMode==='math') analyzeMath(text);
            else analyzeLiteracy(text);
        }

        function analyzeMath(text) {
            let expr = text.toLowerCase();
            Object.keys(wordMap).forEach(w=> expr = expr.replace(new RegExp(`\\b${w}\\b`,'g'), wordMap[w]));
            if(!expr.includes('=')) return analysisDiv.textContent="I didn't catch an = sign. Please include your answer.";
            const [left,right] = expr.split('=').map(s=>s.trim());
            const match = left.match(/(\d+)([+\-*/])(\d+)/);
            if(!match) return analysisDiv.textContent="Please say problems like '2 plus 3 equals 5'.";
            const n1=+match[1], op=match[2], n2=+match[3];
            let correct;
            switch(op){ case '+': correct=n1+n2; break; case '-': correct=n1-n2; break; case '*': correct=n1*n2; break; case '/': correct=n2? n1/n2 : NaN; break; }
            const userAns = parseFloat(right);
            if(isNaN(correct) || isNaN(userAns)) return analysisDiv.textContent="Couldn't parse numbers properly.";
            if(Math.abs(userAns-correct)<0.01){ updateXP(25); analysisDiv.innerHTML = `✔️ ${n1} ${op} ${n2} = ${correct}. +25 XP`; speak(`Correct! You earned 25 XP.`); }
            else { updateXP(-10); analysisDiv.innerHTML = `❌ ${n1} ${op} ${n2} = ${userAns}. Correct is ${correct}. -10 XP`; speak(`Not quite. The correct answer is ${correct}.`); }
        }

        function analyzeLiteracy(text) {
            // simplified error check
            const errors = {'their':'Did you mean there or they\'re?','there':'Did you mean their?'};
            let count=0, html='';
            text.split(/\s+/).forEach(word=>{
                const w=word.toLowerCase().replace(/[.,!?]/g,'');
                if(errors[w]){ count++; html+=`<span style='background:rgba(239,68,68,0.2)'>${word}<span class='tooltip'>${errors[w]}</span></span> `; }
                else html+=word+' ';
            });
            analysisDiv.innerHTML = html;
            speak(count?`Found ${count} potential error(s).`:'Great job!');
        }

        function updateXP(delta) {
            userXP = Math.max(0, userXP+delta);
            if(userXP>=xpForLevelUp){ userLevel++; userXP-=xpForLevelUp; speak(`Level up! You're now level ${userLevel}.`); }
            levelDisplay.textContent=`Level ${userLevel}`;
            xpDisplay.textContent=`${userXP} / ${xpForLevelUp} XP`;
            xpBar.style.width = `${(userXP/xpForLevelUp)*100}%`;
        }

        function speak(msg) {
            if(synthesis.speaking) return setTimeout(()=>speak(msg),200);
            const u=new SpeechSynthesisUtterance(msg); synthesis.speak(u);
        }

        initialize();
    </script>
</body>
</html>
